@using Azure.Core
@model IEnumerable<TM.Models.Entities.Tour>
@using Microsoft.AspNetCore.Http

@{
    ViewData["Title"] = "Danh sách Tour";
    var startDate = Context.Request.Query["startDate"];
    var endDate = Context.Request.Query["endDate"];
    var locationId = Context.Request.Query["locationId"];
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

<h2 class="my-4">Danh sách Tour</h2>

<form class="row g-3 mb-4" method="get" asp-action="Index">
    <div class="col-md-3">
        <label for="startDate" class="form-label">Từ ngày</label>
        <input type="date" class="form-control" id="startDate" name="startDate" value="@startDate" />
    </div>
    <div class="col-md-3">
        <label for="endDate" class="form-label">Đến ngày</label>
        <input type="date" class="form-control" id="endDate" name="endDate" value="@endDate" />
    </div>
    <div class="col-md-3">
        <label for="locationId" class="form-label">Địa điểm</label>
        <select class="form-select" id="locationId" name="locationId">
            <option value="0" selected="@((locationId == "0").ToString())">Tất cả</option>
            @if (ViewBag.LocationList != null)
            {
                foreach (var loc in ViewBag.LocationList)
                {
                    <option value="@loc.Id" selected="@((locationId == loc.Id.ToString()).ToString())">@loc.Name</option>
                }
            }
        </select>
    </div>
    <div class="col-md-3 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">
            <i class="bi bi-search"></i> Lọc Tour
        </button>
    </div>
</form>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    @foreach (var item in Model)
    {
        <div class="col">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title text-primary fw-bold">@item.Name</h5>
                    <h6 class="card-subtitle mb-2 text-muted">
                        @item.StartDate.ToString("dd/MM/yyyy") - @item.EndDate.ToString("dd/MM/yyyy")
                    </h6>
                    <p class="card-text">
                        <strong>Địa điểm:</strong> @item.Location?.LocationName <br />
                        <strong>Giá gốc:</strong> @string.Format("{0:N0}₫", item.SuggestPrice) <br />
                        <strong>Giá KM:</strong> @string.Format("{0:N0}₫", item.DiscountPrice) <br />
                        <strong>Chỗ trống:</strong>
                        @if (item.AvailableSeats == 0)
                        {
                            <span class="badge bg-danger">Hết chỗ</span>
                        }
                        else
                        {
                            <span class="badge bg-success">@item.AvailableSeats chỗ</span>
                        }
                        <br />
                        <strong>Chuyến đi:</strong> @item.DepartureFlightInfo <br />
                        <strong>Chuyến về:</strong> @item.ArrivalFlightInfo
                    </p>
                </div>
                <div class="card-footer text-end bg-white border-0">
                    <a class="btn btn-sm btn-outline-info me-1" asp-action="Details" asp-route-id="@item.Id" title="Chi tiết">
                        <i class="bi bi-eye"></i>
                    </a>
                    <a class="btn btn-sm btn-outline-warning me-1" asp-action="Edit" asp-route-id="@item.Id" title="Chỉnh sửa">
                        <i class="bi bi-pencil"></i>
                    </a>
                    <a class="btn btn-sm btn-outline-danger" asp-action="Delete" asp-route-id="@item.Id" title="Xóa">
                        <i class="bi bi-trash"></i>
                    </a>
                </div>
            </div>
        </div>
    }
</div>
