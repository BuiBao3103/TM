@using Azure.Core
@model IEnumerable<TM.Models.Entities.Tour>
@using Microsoft.AspNetCore.Http  
 
@{  
    ViewData["Title"] = "Danh sách Tour";  
    var startDate = Context.Request.Query["startDate"];  
    var endDate = Context.Request.Query["endDate"];  
    var locationId = Context.Request.Query["locationId"];  
}
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

<h2 class="my-4">Danh sách Tour</h2>

<form class="row g-3 mb-4" method="get" asp-action="Index">
    <div class="col-md-3">
        <label for="startDate" class="form-label">Từ ngày</label>
        <input type="date" class="form-control" id="startDate" name="startDate" value="@startDate" />
    </div>
    <div class="col-md-3">
        <label for="endDate" class="form-label">Đến ngày</label>
        <input type="date" class="form-control" id="endDate" name="endDate" value="@endDate" />
    </div>
    @* <div class="col-md-3"> *@
    @*     <label for="locationId" class="form-label">Địa điểm</label> *@
    @*     <select class="form-select" id="locationId" name="locationId"> *@
    @*         <option value="0" @(locationId == "0" ? "selected" : "")>Tất cả</option> *@
    @*         <!-- Bạn cần load danh sách Location từ ViewBag.LocationList --> *@
    @*         @if (ViewBag.LocationList != null) *@
    @*         { *@
    @*             foreach (var loc in ViewBag.LocationList) *@
    @*             { *@
    @*                 <option value="@loc.Id" @(locationId == loc.Id.ToString() ? "selected" : "")>@loc.Name</option> *@
    @*             } *@
    @*         } *@
    @*     </select> *@
    @* </div> *@
    <div class="col-md-3 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">
            <i class="bi bi-search"></i> Lọc Tour
        </button>
    </div>
</form>

<table class="table table-bordered table-hover table-striped">
    <thead class="table-dark">
        <tr>
            <th>Tên Tour</th>
            <th>Mã Tour</th>
            <th>Ngày đi</th>
            <th>Ngày về</th>
            <th>Tổng chỗ</th>
            <th>Còn trống</th>
            <th>Giá Gốc</th>
            <th>Giá KM</th>
            <th>HH</th>
            <th>Visa?</th>
            <th>Chuyến đi</th>
            <th>Chuyến về</th>
            <th>Địa điểm</th>
            <th>Hành động</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr class="align-middle">
                <td>@item.Name</td>
                <td>@item.Code</td>
                <td>@item.StartDate.ToString("dd/MM/yyyy")</td>
                <td>@item.EndDate.ToString("dd/MM/yyyy")</td>
                <td>@item.TotalSeats</td>
                <td>
                    @if (item.AvailableSeats == 0)
                    {
                        <span class="badge bg-danger">Hết chỗ</span>
                    }
                    else
                    {
                        <span class="badge bg-success">@item.AvailableSeats chỗ</span>
                    }
                </td>
                <td>@string.Format("{0:N0}₫", item.SuggestPrice)</td>
                <td>@string.Format("{0:N0}₫", item.DiscountPrice)</td>
                <td>@string.Format("{0:N0}₫", item.HhFee)</td>
                @* <td>@(item.IsVisaRequired ? "✔" : "✘")</td> *@
                <td>@item.DepartureFlightInfo</td>
                <td>@item.ArrivalFlightInfo</td>
                <td>@item.Location?.LocationName</td>
                <td>
                    <a class="btn btn-sm btn-info" asp-action="Details" asp-route-id="@item.Id" title="Chi tiết">
                        <i class="bi bi-eye"></i>
                    </a>
                    <a class="btn btn-sm btn-warning" asp-action="Edit" asp-route-id="@item.Id" title="Chỉnh sửa">
                        <i class="bi bi-pencil"></i>
                    </a>
                    <a class="btn btn-sm btn-danger" asp-action="Delete" asp-route-id="@item.Id" title="Xóa">
                        <i class="bi bi-trash"></i>
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>
