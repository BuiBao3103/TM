
@{
    ViewData["Title"] = "Passengers";
}
@* <head> *@
    <style>
        :root {
            --primary: #0066bb;
            --primary-bg: #f8f8f8;
            --secondary-bg: #eeeeee;
            --gray-light: #cccccc;
            --active: #409404;
            --inactive: #b0b0b0;
            --offline: #bbbbbb;
            --tag-dev: #2196f3;
            --tag-qa: #ffc107;
            --tag-design: #e91e63;
            --tag-marketing: #ff545e;
            --border-color: var(--text);
            --font-family: sans-serif;
            --font-size-base: 0.85rem;
            --font-size-lg: 1.25rem;
            --font-size-xl: 2rem;
            --spacing-md: 0.5rem;
            --spacing-lg: 1rem;
            --spacing-xl: 2rem;
        }

        margin: 0;
        padding: 0;
        box-sizing: border-box;

        body {
            font-family: var(--font-family);
            display: grid;
            place-items: center;
            height: 100vh;
            background-color: var(--bg);
            color: var(--text);
        }

        .table-widget {
            border-radius: 1rem;
            background: var(--table-bg);
            padding: var(--spacing-lg);
            text-align: left;
            overflow: auto;
            user-select: none;
            color: var(--text);
            border: 1px solid var(--border-color);
            min-width: 500px;
            max-width: 800px;
        }

            .table-widget table {
                width: 100%;
                border-collapse: collapse;
                table-layout: auto;
            }

            .table-widget th:hover {
                color: var(--primary);
            }

            .table-widget th::after {
                content: "";
                font-size: 0.75rem;
                margin-left: 8px;
                color: var(--text);
            }

            .table-widget th:hover::after,
            .table-widget th:active::before {
                color: var(--primary);
            }

            .table-widget th.sorted-asc::after {
                content: "▲";
            }

            .table-widget th.sorted-desc::after {
                content: "▼";
            }

            .table-widget td {
                padding: var(--spacing-md);
                background-color: transparent;
                color: var(--text);
                vertical-align: middle;
                border-bottom: 1px solid var(--gray-light);
                white-space: nowrap;
            }

            .table-widget tbody tr:hover img,
            .table-widget tbody tr:hover td {
                border-color: var(--primary);
            }

            .table-widget tbody tr:hover td {
                cursor: pointer;
                color: var(--primary);
            }

            .table-widget .caption {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: var(--spacing-md);
            }

        .export-btn {
            padding: var(--spacing-sm);
            border: none;
            border-radius: 0.25rem;
            background-color: var(--primary);
            color: white;
            font-size: var(--font-size-large);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: var(--spacing-sm);
            transition: 0.2s ease;
        }

            .export-btn:hover {
                background-color: var(--primary-dark);
            }

            .export-btn svg {
                width: 1.2rem;
                height: 1.2rem;
                fill: white;
            }

        .table-widget th {
            padding: var(--spacing-md);
            font-size: var(--font-size-base);
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text);
            border-bottom: 1px solid var(--border-color);
            text-align: left;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
    </style>
@* </head> *@

<article class="table-widget">
    <div class="caption">
        <h2>Team Members</h2>
        <button class="export-btn" type="button">
            Export
        </button>
    </div>
    <table id="team-table">
        <thead>
            <tr>
                <th class="resizable" data-column="0">Name</th>
            </tr>
        </thead>
        <tbody id="team-member-rows">
            <tr>
                <td class="team-member-profile">
                    <img src="assets/drew.jpg" alt="Drew Crano">
                    <div class="profile-info">
                        <div class="profile-info-name">Drew Crano</div>
                        <div class="profile-info-alias">drew</div>
                    </div>
                </td>
                <td>
                    <div class="status">
                        <div class="status_circle status--active"></div>
                        Active
                    </div>
                </td>
                <td>drew.cranoexample.com</td>
                <td>
                    <div class="tags">
                        <div class="class-tag tag--marketing">
                            Marketing
                        </div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</article>
<script>
    document.querySelectorAll('#team-table th.resizable').forEach(th => {
        let startX, startWidth;

        const resizer = document.createElement('div');
        resizer.style.width = '1px';
        resizer.style.height = '100%';
        resizer.style.position = 'absolute';
        resizer.style.top = '0';
        resizer.style.right = '0';
        resizer.style.background = 'rgba(0, 0, 0, 0.1)';
        resizer.style.cursor = 'col-resize';
        th.style.position = 'relative';

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            startX = e.pageX;
            startWidth = parseInt(document.defaultView.getComputedStyle(th).width, 10);

            document.documentElement.addEventListener('mousemove', onMouseMove);
            document.documentElement.addEventListener('mouseup', onMouseUp);
        });

        function onMouseMove(e) {
            const newWidth = startWidth + (e.pageX - startX);
            th.style.width = newWidth + 'px';
        }

        function onMouseUp() {
            document.documentElement.removeEventListener(
                'mousemove',
                onMouseMove
            );
            document.documentElement.removeEventListener(
                'mouseup',
                onMouseUp
            );
            setTimeout(() => (isResizing = false), 100);
        }

        th.appendChild(resizer);
    });
        function sortTableByColumn(columnIndex) {
        if (isResizing) { // Check if resizing just happened
            return;
        }

        const table = document.getElementById('team-table');
        const rows = Array.from(table.querySelectorAll('tbody tr'));

        const isTextColumn = columnIndex !== 1; // Assuming column 1 (index 0) is text and others are numbers. Adjust as needed.

        const direction = (currentSortColumn === columnIndex && currentSortDirection === 'asc') ? 'desc' : 'asc';

        rows.sort((rowA, rowB) => {
            let cellA = rowA.children[columnIndex].textContent.trim();
            let cellB = rowB.children[columnIndex].textContent.trim();

            if (isTextColumn) {
                cellA = cellA.toLowerCase();
                cellB = cellB.toLowerCase();
            }

            if (direction === 'asc') {
                return cellA.localeCompare(cellB, undefined, { numeric: true });
            } else {
                return cellB.localeCompare(cellA, undefined, { numeric: true });
            }
        });

        for (const row of rows) {
            table.querySelector('tbody').appendChild(row);
        }

        document.querySelectorAll('#team-table th').forEach(th => {
            th.classList.remove('sorted-asc', 'sorted-desc');
        });

        const header = document.querySelector(
            `#team-table th:nth-child(${columnIndex + 1})`
        );
        header.classList.add(direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
        currentSortColumn = columnIndex;
        currentSortDirection = direction;
    }
        const exportButton = document.querySelector(".export-btn");

    function exportHtmlTableToCSV(selector) {
        const table = document.querySelector(selector);
        const rows = Array.from(table.rows);
        const teamMembers = rows.map((row) =>
            Array.from(row.cells).map((cell) => cell.innerText.replace(/\n/g, " "))
        );

        const csvContent =
            "data:text/csv;charset=utf-8," +
            teamMembers
                .map((teamMember) => Object.values(teamMember).join(","))
                .join("\n");

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "team-members.csv");
        document.body.appendChild(link);
        link.click();
    }

    exportButton.addEventListener("click", function() {
        exportHtmlTableToCSV(".table-widget table");
    });

    let currentSortColumn = null;
    let currentSortDirection = 'asc';
    let isResizing = false; // NEW FLAG
    </script>

